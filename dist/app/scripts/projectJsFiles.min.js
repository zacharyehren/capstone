angular.module("capstone",["ui.router","ui.bootstrap","ngCookies","ngRoute"]).config(function(t,e){t.html5Mode({enabled:!0,requireBase:!1}),e.state("home",{url:"/",controller:"HomeCtrl as home",templateUrl:"/templates/home.html"}).state("ticket",{url:"/ticket",controller:"TicketCtrl as ticket",templateUrl:"/templates/ticket.html"}).state("closedTickets",{url:"/closed-tickets",controller:"ClosedTicketCtrl as closedTickets",templateUrl:"/templates/closedTickets.html"}).state("newTicket",{url:"/new-ticket",controller:"NewTicketCtrl as newTicket",templateUrl:"/templates/newTicket.html"}).state("myTickets",{url:"/my-tickets",controller:"MyTicketCtrl as myTickets",templateUrl:"/templates/myTicket.html"})}),angular.module("capstone").factory("GoogleOauth",["ZenFactory","$cookies",function(t,e){var s,o,i={signOut:function(){gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")})}};return window.onSignIn=function(t){o=t.getBasicProfile(),domain=t.getHostedDomain(),"sharethrough.com"==domain?null==e.get("zendeskUserEmail")&&(s={name:o.getName(),email:o.getEmail()},i.userObject=s,e.put("zendeskUserEmail",s.email),e.put("zendeskUserName",s.name),location.reload()):(alert("Only Sharethrough emails have access."),i.signOut())},i}]),angular.module("capstone").factory("SortData",["ZenFactory","$cookies",function t(e,s){var o="",i="";return t.ticketSort=function(t,s,n){""==o||"desc"==o||i!=t?(o="asc",i=t,e[s][n].sort(function(e,s){return e[t].localeCompare(s[t])})):"asc"==o&&(o="desc",e[s][n].sort(function(e,s){return s[t].localeCompare(e[t])}))},t}]),angular.module("capstone").factory("ZenFactory",["$http","$cookies",function(t,e){var s={},o=function(t){for(var e=t.tickets,s=t.incidents,o=0;o<e.length;o++)for(var i=0;i<s.length;i++)e[o].id==s[i].problem_id&&(e[o].hasIncident=!0)};return s.listTickets=function(){var i={method:"GET",url:"http://quiet-brushlands-48260.herokuapp.com/api/tickets",params:{username:e.get("zendeskUserName")}};return t(i).then(function(t){s.unsolvedTickets=t.data,o(s.unsolvedTickets),console.log(s.unsolvedTickets)})},s.listClosedTickets=function(){return t({method:"GET",url:"http://quiet-brushlands-48260.herokuapp.com/api/closed_tickets"}).then(function(t){s.closedTickets=t.data,o(s.closedTickets)})},s.createTicket=function(o,i){var n={method:"POST",url:"http://quiet-brushlands-48260.herokuapp.com/api/tickets",data:{subject:o,comment_body:i,submitter_email:e.get("zendeskUserEmail"),submitter_name:e.get("zendeskUserName")}};t(n).then(function(t){s.newTicket=t.data})},s.returnTicket=function(){var o={method:"GET",url:"http://quiet-brushlands-48260.herokuapp.com/api/tickets/"+e.get("zendeskTicketId")};return t(o).then(function(t){s.ticket=t.data})},s.createComment=function(o){var i={method:"POST",url:"http://quiet-brushlands-48260.herokuapp.com/api/tickets/new_comment",data:{user_email:e.get("zendeskUserEmail"),comment_body:o,id:e.get("zendeskTicketId")}};t(i).then(function(t){s.newComment=t.data})},s}]),angular.module("capstone").controller("ClosedTicketCtrl",["GoogleOauth","ZenFactory","SortData","$cookies","$location","$anchorScroll","$scope","$stateParams",function(t,e,s,o,i,n,a,c){this.sortClass="",this.selected="",this.sortData=function(t){this.selected!=t&&(this.sortClass=""),this.selected=t,""==this.sortClass||"down-carat"==this.sortClass?(this.sortClass="up-carat",s.ticketSort(t,"closedTickets","tickets")):"up-carat"==this.sortClass&&(this.sortClass="down-carat",s.ticketSort(t,"closedTickets","tickets"))},this.loading=!0;var r=function(){this.loading=!1};r=r.bind(this),e.listClosedTickets().then(r),this.ZenFactory=e,this.passTicketInfo=function(t,e){o.put("zendeskTicketId",t),o.put("zendeskTicketSubject",e)},a.$watchCollection("$stateParams",function(){n()})}]),angular.module("capstone").controller("HomeCtrl",["GoogleOauth","ZenFactory","SortData","$cookies","$location","$anchorScroll","$scope","$stateParams",function(t,e,s,o,i,n,a,c){this.sortClass="",this.selected="",this.sortData=function(t){this.selected!=t&&(this.sortClass=""),this.selected=t,""==this.sortClass||"down-carat"==this.sortClass?(this.sortClass="up-carat",s.ticketSort(t,"unsolvedTickets","tickets")):"up-carat"==this.sortClass&&(this.sortClass="down-carat",s.ticketSort(t,"unsolvedTickets","tickets"))},this.userSignedOut=function(){return null==o.get("zendeskUserEmail")},this.loading=!0;var r=function(){this.loading=!1};r=r.bind(this),null!=o.get("zendeskUserEmail")?e.listTickets().then(r):r(),this.ZenFactory=e,this.passTicketInfo=function(t,e){o.put("zendeskTicketId",t),o.put("zendeskTicketSubject",e)},a.$watchCollection("$stateParams",function(){n()})}]),angular.module("capstone").controller("IndexCtrl",["GoogleOauth","ZenFactory","$cookies",function(t,e,s){this.userSignedIn=function(){return null!=s.get("zendeskUserEmail")},this.ZenFactory=e,this.user=s.get("zendeskUserName"),this.signOut=function(){t.signOut();var e=s.getAll();angular.forEach(e,function(t,e){s.remove(e)}),window.location="/"}}]),angular.module("capstone").controller("LinkedTicketsModalCtrl",["$uibModal",function(t){this.openModal=function(e,s){t.open({animation:this.animationsEnabled,templateUrl:"/templates/linkedTicketsModal.html",controller:"LinkedTicketsModalInstanceCtrl",controllerAs:"linkedTicketsModal",resolve:{selectedTicketId:e,ZenFactoryObject:s}})}}]),angular.module("capstone").controller("LinkedTicketsModalInstanceCtrl",["$uibModalInstance","ZenFactory","SortData","$cookies","selectedTicketId","ZenFactoryObject",function(t,e,s,o,i,n){this.sortClass="",this.selected="",this.selectedTicket=i,this.ZenFactoryObject=n,this.sortData=function(t){this.selected!=t&&(this.sortClass=""),this.selected=t,""==this.sortClass||"down-carat"==this.sortClass?(this.sortClass="up-carat",this.linkedTicketArray.sort(function(e,s){return e[t].localeCompare(s[t])})):"up-carat"==this.sortClass&&(this.sortClass="down-carat",this.linkedTicketArray.sort(function(e,s){return s[t].localeCompare(e[t])}))};var a=function(){this.linkedTicketArray=[];var t=this.ZenFactoryObject.tickets,e=this.ZenFactoryObject.incidents;if("incident"==this.selectedTicket.type)for(var s=0;s<t.length;s++)this.selectedTicket.problem_id==t[s].id&&this.linkedTicketArray.push(t[s]);else for(s=0;s<e.length;s++)this.selectedTicket.id==e[s].problem_id&&this.linkedTicketArray.push(e[s])};(a=a.bind(this))(),this.ZenFactory=e,this.ticketSubject=o.get("zendeskTicketSubject"),this.passTicketInfo=function(e,s){o.put("zendeskTicketId",e),o.put("zendeskTicketSubject",s),t.close()},this.closeModal=function(){t.dismiss()}}]),angular.module("capstone").controller("MyTicketCtrl",["GoogleOauth","ZenFactory","SortData","$cookies","$location","$anchorScroll","$scope","$stateParams",function(t,e,s,o,i,n,a,c){this.sortClass="",this.selected="",this.sortData=function(t){this.selected!=t&&(this.sortClass=""),this.selected=t,""==this.sortClass||"down-carat"==this.sortClass?(this.sortClass="up-carat",s.ticketSort(t,"unsolvedTickets","my_tickets")):"up-carat"==this.sortClass&&(this.sortClass="down-carat",s.ticketSort(t,"unsolvedTickets","my_tickets"))},this.loading=!0;var r=function(){this.loading=!1};r=r.bind(this),e.listTickets().then(r),this.ZenFactory=e,this.passTicketInfo=function(t,e){o.put("zendeskTicketId",t),o.put("zendeskTicketSubject",e)},a.$watchCollection("$stateParams",function(){n()})}]),angular.module("capstone").controller("NewTicketCtrl",["GoogleOauth","ZenFactory","$cookies","$location",function(t,e,s,o){this.ZenFactory=e,this.submitter=s.get("zendeskUserEmail"),this.createTicket=function(){e.createTicket(this.subject,this.comment),o.path("/")}}]),angular.module("capstone").controller("TicketCtrl",["ZenFactory","$cookies","$location","$anchorScroll","$scope","$stateParams",function(t,e,s,o,i,n){this.loading=!0;var a=function(){this.loading=!1};a=a.bind(this),t.returnTicket().then(a),this.ZenFactory=t,this.ticketSubject=e.get("zendeskTicketSubject"),this.createComment=function(){this.submitted=!0,t.createComment(this.commentBody)},i.$watchCollection("$stateParams",function(){o()})}]);